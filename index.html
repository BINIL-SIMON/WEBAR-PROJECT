<!DOCTYPE html>
<html>
<head>
  <title>WEBAR PROJECT</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.1.7/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    
    <!-- Marker for tracking -->
    <a-marker type="pattern" url="pattern-hiro.patt" emitevents="true" id="marker">
      <!-- Plane that displays a dynamic image -->
      <a-plane id="imagePlane" position="4 0 0" rotation="-90 0 0" 
               width="4" height="2.25" 
               material="shader: flat; src: #dynamicImage">
      </a-plane>
    </a-marker>
    
    <!-- Camera -->
    <a-entity camera></a-entity>

    <!-- Dynamic image source -->
    <a-assets>
      <img id="dynamicImage" src="756e916a-2749-4cec-83e0-ff574c7eabcc.jpg" crossorigin="anonymous" />
    </a-assets>
    
  </a-scene>

  <script>
    const imagePlane = document.querySelector("#imagePlane");
    const marker = document.querySelector("#marker");
    const imageAsset = document.querySelector("#dynamicImage");

    const imageUrl = "WhatsApp%20Image%202025-04-10%20at%2010.54.37%20AM.jpeg";
    const animationDuration = 1000; // in ms
    let isAnimating = false;

    marker.addEventListener("markerFound", () => {
      if (!isAnimating) animatePlaneTo(0); // Move to marker (center)
    });

    marker.addEventListener("markerLost", () => {
      if (!isAnimating) animatePlaneTo(4); // Move away from marker
    });

    function animatePlaneTo(targetX) {
      const start = performance.now();
      const startPos = parseFloat(imagePlane.getAttribute("position").x);

      isAnimating = true;

      function step(time) {
        const elapsed = time - start;
        const progress = Math.min(elapsed / animationDuration, 1);
        const newX = startPos + (targetX - startPos) * progress;
        imagePlane.setAttribute("position", `${newX} 0 0`);

        if (progress < 1) {
          requestAnimationFrame(step);
        } else {
          isAnimating = false;
        }
      }

      requestAnimationFrame(step);
    }

    // Reload image every 5 seconds to reflect updates
    function updateImage() {
      const timestamp = Date.now();
      imageAsset.setAttribute("src", `${imageUrl}?v=${timestamp}`);
    }

    setInterval(updateImage, 5000);
  </script>
</body>
</html>
